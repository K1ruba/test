trigger: none   

stages:
  - stage: Deploy
    displayName: Deploy to AKS
    jobs:
      - job: DeployToK8s
        displayName: Deploy to Kubernetes
        pool:
          name: Default
        steps:
          # Download build artifact from Build pipeline (ID 7)
          - task: DownloadPipelineArtifact@2
            displayName: 'Download build artifacts'
            inputs:
              buildType: 'specific'
              project: 'demo'            
              definition: '7'             # Build pipeline ID
              buildVersionToDownload: 'latest'
              artifactName: 'manifests'  # <-- must match build pipeline
              targetPath: '$(Pipeline.Workspace)/manifests'

          # Deploy manifests to AKS
          - task: KubernetesManifest@1
            displayName: 'Deploy manifests to AKS'
            inputs:
              action: 'deploy'
              kubernetesServiceConnection: 'yuno'  
              namespace: 'default'
              manifests: |
                $(Pipeline.Workspace)/manifests/deployment.yaml
                $(Pipeline.Workspace)/manifests/service.yaml
              containers: |
                testingac.azurecr.io/apache-app:$(Build.BuildId)


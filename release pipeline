trigger: none

stages:
  - stage: Deploy
    displayName: Deploy to AKS
    jobs:
      - job: DeployToK8s
        displayName: Deploy to Kubernetes
        pool:
          name: Default
        steps:
          - task: DownloadPipelineArtifact@2
            displayName: 'Download manifests'
            inputs:
              buildType: 'specific'
              project: 'demo'
              definition: '7'
              buildVersionToDownload: 'latest'
              artifactName: 'manifests'
              targetPath: '$(Pipeline.Workspace)/manifests'

          - task: KubernetesManifest@1
            displayName: 'Deploy to AKS'
            inputs:
              action: 'deploy'
              kubernetesServiceConnection: 'yuno'
              namespace: 'default'
              manifests: |
                $(Pipeline.Workspace)/manifests/deployment.yaml
                $(Pipeline.Workspace)/manifests/service.yaml
              containers: |
                testingac.azurecr.io/apache-app:latest
